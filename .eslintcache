[{"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\App.tsx":"1","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\reportWebVitals.ts":"2","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\index.tsx":"3","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\auth\\Signup.tsx":"4","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\utils\\index.ts":"5","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\routes\\index.tsx":"6","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\routes\\Hoc.tsx":"7","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\auth\\Login.tsx":"8","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\components\\FieldWithValidation.tsx":"9","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\utils\\apiClient.ts":"10","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\components\\UploadFile.tsx":"11","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\layouts\\Main.tsx":"12","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\Body.tsx":"13","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Admin\\index.tsx":"14","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\Side.tsx":"15","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\layouts\\Auth.tsx":"16","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\index.tsx":"17","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\404.tsx":"18","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\Message.tsx":"19"},{"size":955,"mtime":1606752924263,"results":"20","hashOfConfig":"21"},{"size":425,"mtime":1606394056262,"results":"22","hashOfConfig":"21"},{"size":497,"mtime":1606753052834,"results":"23","hashOfConfig":"21"},{"size":5319,"mtime":1607175419075,"results":"24","hashOfConfig":"21"},{"size":1817,"mtime":1606981996950,"results":"25","hashOfConfig":"21"},{"size":1030,"mtime":1606989116982,"results":"26","hashOfConfig":"21"},{"size":814,"mtime":1606988690423,"results":"27","hashOfConfig":"21"},{"size":3362,"mtime":1607099127675,"results":"28","hashOfConfig":"21"},{"size":657,"mtime":1606739969629,"results":"29","hashOfConfig":"21"},{"size":598,"mtime":1606755555058,"results":"30","hashOfConfig":"21"},{"size":2864,"mtime":1607432575905,"results":"31","hashOfConfig":"21"},{"size":2941,"mtime":1606990132181,"results":"32","hashOfConfig":"21"},{"size":7276,"mtime":1607445692789,"results":"33","hashOfConfig":"21"},{"size":398,"mtime":1607099012551,"results":"34","hashOfConfig":"21"},{"size":5310,"mtime":1606989964327,"results":"35","hashOfConfig":"21"},{"size":236,"mtime":1606990551717,"results":"36","hashOfConfig":"21"},{"size":6643,"mtime":1607502550385,"results":"37","hashOfConfig":"21"},{"size":227,"mtime":1606988631945,"results":"38","hashOfConfig":"21"},{"size":1525,"mtime":1607412462247,"results":"39","hashOfConfig":"21"},{"filePath":"40","messages":"41","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"42"},"1josc0v",{"filePath":"43","messages":"44","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"45"},{"filePath":"46","messages":"47","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"48"},{"filePath":"49","messages":"50","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"51","messages":"52","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"53","messages":"54","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"55","messages":"56","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"57"},{"filePath":"58","messages":"59","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"60","messages":"61","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"62","messages":"63","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"64"},{"filePath":"65","messages":"66","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"67"},{"filePath":"68","messages":"69","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"70","messages":"71","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"72","messages":"73","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"45"},{"filePath":"74","messages":"75","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"76"},{"filePath":"77","messages":"78","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"79"},{"filePath":"80","messages":"81","errorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"82","messages":"83","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"84","messages":"85","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\App.tsx",[],["86","87"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\reportWebVitals.ts",[],["88","89"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\index.tsx",[],["90","91"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\auth\\Signup.tsx",[],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\utils\\index.ts",[],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\routes\\index.tsx",[],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\routes\\Hoc.tsx",[],["92","93"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\auth\\Login.tsx",["94"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\components\\FieldWithValidation.tsx",[],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\utils\\apiClient.ts",[],["95","96"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\components\\UploadFile.tsx",["97","98","99","100"],"import React, { useMemo, useState } from 'react';\r\nimport { Modal, Upload } from 'antd';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport axios from 'axios';\r\n\r\nimport { getToken } from 'utils';\r\n\r\nimport { RcCustomRequestOptions } from 'antd/lib/upload/interface';\r\nimport { IUpload } from 'types';\r\n\r\ntype Props = {\r\n  isVisible: boolean;\r\n  onClose: () => void;\r\n  onOk: (uploads: IUpload[]) => void;\r\n};\r\n\r\nconst UploadFile: React.FC<Props> = ({ isVisible, onClose, onOk }) => {\r\n  const [uploads, setUploads] = useState<IUpload[]>([]);\r\n\r\n  const photos = useMemo(() => {\r\n    return uploads.map((photo) => ({\r\n      uid: photo._id,\r\n      name: photo.filename,\r\n      size: 50,\r\n      type: photo.mimetype as string,\r\n      url: photo.path,\r\n    }));\r\n  }, [uploads]);\r\n\r\n  const uploadFile = async (fileInfo: RcCustomRequestOptions) => {\r\n    console.log('args', fileInfo);\r\n    const token = getToken();\r\n\r\n    const file = fileInfo.file;\r\n    const data = new FormData();\r\n    data.append('file', file);\r\n\r\n    var reader = new FileReader();\r\n\r\n    //Read the contents of Image File.\r\n    reader.readAsDataURL(file);\r\n\r\n    reader.onload = function (e) {\r\n      //Initiate the JavaScript Image object.\r\n      var image = new Image();\r\n\r\n      //Set the Base64 string return from FileReader as source.\r\n      image.src = e.target!.result as string;\r\n\r\n      //Validate the File Height and Width.\r\n      image.onload = function () {\r\n        // @ts-ignore\r\n        var height = this.height;\r\n        // @ts-ignore\r\n        var width = this.width;\r\n        console.log('height withd', width, height);\r\n      };\r\n    };\r\n\r\n    try {\r\n      const response = (\r\n        await axios({\r\n          method: 'post',\r\n          url: process.env.REACT_APP_FILE_URL,\r\n          data,\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        })\r\n      ).data[0];\r\n\r\n      setUploads((v) => [...v, response]);\r\n      console.log('resp', response);\r\n    } catch (e) {\r\n      console.error('error in uploading', e);\r\n    }\r\n  };\r\n\r\n  const onCloseModal = () => {\r\n    setUploads([]);\r\n    onClose();\r\n  };\r\n\r\n  const onSendPhoto = () => {\r\n    setUploads([]);\r\n    onOk(uploads);\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      visible={isVisible}\r\n      onCancel={onCloseModal}\r\n      onOk={() => onSendPhoto()}\r\n      okText=\"Отправить\"\r\n      cancelText=\"Отменить\"\r\n      centered\r\n      destroyOnClose\r\n    >\r\n      <Upload\r\n        customRequest={uploadFile}\r\n        listType=\"picture-card\"\r\n        fileList={photos}\r\n        onChange={(arg) => console.log('file', arg)}\r\n      >\r\n        {uploads.length >= 4 ? null : (\r\n          <div>\r\n            <PlusOutlined />\r\n            <div style={{ marginTop: 8 }}>Загрузить</div>\r\n          </div>\r\n        )}\r\n      </Upload>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UploadFile;\r\n","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\layouts\\Main.tsx",["101","102"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\Body.tsx",["103","104"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Admin\\index.tsx",[],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\Side.tsx",["105"],"import { Paginated } from '@feathersjs/feathers';\r\nimport { Input } from 'antd';\r\nimport Avatar from 'antd/lib/avatar/avatar';\r\nimport clsx from 'clsx';\r\nimport moment from 'moment';\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport ReactLoading from 'react-loading';\r\n\r\nimport { IChat } from 'types';\r\nimport { getReceiver, getUser } from 'utils';\r\nimport apiClient from 'utils/apiClient';\r\n\r\ntype Props = {\r\n  chats: IChat[];\r\n  activeChat: Partial<IChat>;\r\n  setChats: React.Dispatch<React.SetStateAction<IChat[]>>;\r\n  onChatClick: (chat: IChat) => void;\r\n};\r\n\r\nconst Side: React.FC<Props> = ({\r\n  chats,\r\n  activeChat,\r\n  setChats,\r\n  onChatClick,\r\n}) => {\r\n  const [hasMore, setHasMore] = useState<boolean>(true);\r\n  const [search, setSearch] = useState<string>('');\r\n\r\n  const filteredChats = useMemo(() => {\r\n    if (!search) return chats;\r\n    return chats.filter(\r\n      (chat) =>\r\n        chat[getReceiver()]?.firstName\r\n          ?.toLowerCase()\r\n          .includes(search.toLowerCase()) ||\r\n        chat[getReceiver()]?.lastName\r\n          ?.toLowerCase()\r\n          .includes(search.toLowerCase())\r\n    );\r\n  }, [search, chats]);\r\n\r\n  const sortedChats = useMemo(() => {\r\n    return filteredChats.sort(\r\n      (a, b) =>\r\n        new Date(b.lastMessageDate).getTime() -\r\n        new Date(a.lastMessageDate).getTime()\r\n    );\r\n  }, [filteredChats]);\r\n\r\n  const getUnreadMessages = (chat: IChat) =>\r\n    chat[\r\n      (getUser().role + 'UnreadMessages') as\r\n        | 'clientUnreadMessages'\r\n        | 'operatorUnreadMessages'\r\n    ];\r\n\r\n  const fetchNewChats = async () => {\r\n    const user = getUser();\r\n    const field = user.role === 'client' ? 'clientId' : 'operatorId';\r\n\r\n    const response: Paginated<IChat> = await apiClient.service('chats').find({\r\n      query: {\r\n        [field]: user._id,\r\n        $limit: 15,\r\n        $skip: chats.length,\r\n        $search: search || undefined,\r\n      },\r\n    });\r\n\r\n    const newItems = chats.concat(response.data);\r\n    setChats(newItems);\r\n\r\n    if (newItems.length >= response.total) {\r\n      setHasMore(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchChats = async () => {\r\n      const user = getUser();\r\n      const field = user.role === 'client' ? 'clientId' : 'operatorId';\r\n\r\n      const response: Paginated<IChat> = await apiClient.service('chats').find({\r\n        query: {\r\n          [field]: user._id,\r\n          $limit: 15,\r\n          $skip: 0,\r\n        },\r\n      });\r\n\r\n      console.log('chats', response);\r\n      setChats(response.data);\r\n    };\r\n\r\n    fetchChats();\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"chat__side\">\r\n      <div className=\"chat__side-search\">\r\n        <Avatar src={getUser().avatar?.path} />\r\n        <Input\r\n          placeholder=\"Поиск\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n        />\r\n      </div>\r\n      <h2 className=\"chat__title\">Чаты</h2>\r\n      <div className=\"chat__side-items\" id=\"scrollableContainer\">\r\n        <InfiniteScroll\r\n          dataLength={chats.length}\r\n          next={fetchNewChats}\r\n          hasMore={hasMore}\r\n          loader={\r\n            chats.length === 0 ? (\r\n              <span />\r\n            ) : (\r\n              <ReactLoading\r\n                type=\"bars\"\r\n                color=\"#69C262\"\r\n                width=\"40px\"\r\n                className=\"loading-center\"\r\n              />\r\n            )\r\n          }\r\n          scrollableTarget=\"scrollableContainer\"\r\n        >\r\n          {sortedChats.map((chat) => {\r\n            return (\r\n              <div\r\n                key={chat._id}\r\n                className={clsx('chat__box', {\r\n                  'chat__box--active': chat._id === activeChat._id,\r\n                })}\r\n                onClick={() => onChatClick(chat)}\r\n              >\r\n                <div className=\"chat__box__left\">\r\n                  <Avatar src={chat[getReceiver()]?.avatar?.path} />\r\n                </div>\r\n                <div className=\"chat__box__center\">\r\n                  <div className=\"chat__box__name\">\r\n                    {chat[getReceiver()]?.firstName}{' '}\r\n                    {chat[getReceiver()]?.lastName}\r\n                  </div>\r\n                  <div className=\"chat__box__last-message\">\r\n                    {chat.lastMessage?.userId === getUser()._id && (\r\n                      <span>Вы:</span>\r\n                    )}\r\n                    {chat.lastMessage?.type === 'text' &&\r\n                      chat.lastMessage?.text}\r\n                    {chat.lastMessage?.type === 'photo' && '📥 Photo'}\r\n                  </div>\r\n                </div>\r\n                <div className=\"chat__box__right\">\r\n                  <div className=\"chat__box__time\">\r\n                    {moment(chat.lastMessage?.createdAt).format('HH:mm')}\r\n                  </div>\r\n                  {!!getUnreadMessages(chat) && (\r\n                    <div className=\"chat__box__messages-count\">\r\n                      {getUnreadMessages(chat)}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </InfiniteScroll>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Side;\r\n","M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\layouts\\Auth.tsx",[],["106","107"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\index.tsx",["108","109","110","111","112","113","114","115","116"],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\404.tsx",[],"M:\\Media Files\\Other\\course-project\\code\\callmaster-frontend\\src\\pages\\Chat\\Message.tsx",[],{"ruleId":"117","replacedBy":"118"},{"ruleId":"119","replacedBy":"120"},{"ruleId":"117","replacedBy":"121"},{"ruleId":"119","replacedBy":"122"},{"ruleId":"117","replacedBy":"123"},{"ruleId":"119","replacedBy":"124"},{"ruleId":"117","replacedBy":"125"},{"ruleId":"119","replacedBy":"126"},{"ruleId":"127","severity":1,"message":"128","line":36,"column":6,"nodeType":"129","endLine":36,"endColumn":8,"suggestions":"130"},{"ruleId":"117","replacedBy":"131"},{"ruleId":"119","replacedBy":"132"},{"ruleId":"133","severity":1,"message":"134","line":31,"column":5,"nodeType":"135","messageId":"136","endLine":31,"endColumn":16},{"ruleId":"133","severity":1,"message":"134","line":56,"column":9,"nodeType":"135","messageId":"136","endLine":56,"endColumn":20},{"ruleId":"133","severity":1,"message":"134","line":71,"column":7,"nodeType":"135","messageId":"136","endLine":71,"endColumn":18},{"ruleId":"133","severity":1,"message":"134","line":101,"column":28,"nodeType":"135","messageId":"136","endLine":101,"endColumn":39},{"ruleId":"137","severity":1,"message":"138","line":13,"column":10,"nodeType":"139","messageId":"140","endLine":13,"endColumn":14},{"ruleId":"141","severity":1,"message":"138","line":13,"column":10,"nodeType":"139","messageId":"140","endLine":13,"endColumn":14},{"ruleId":"137","severity":1,"message":"142","line":27,"column":3,"nodeType":"139","messageId":"140","endLine":27,"endColumn":15},{"ruleId":"133","severity":1,"message":"134","line":157,"column":9,"nodeType":"135","messageId":"136","endLine":157,"endColumn":20},{"ruleId":"133","severity":1,"message":"134","line":92,"column":7,"nodeType":"135","messageId":"136","endLine":92,"endColumn":18},{"ruleId":"117","replacedBy":"143"},{"ruleId":"119","replacedBy":"144"},{"ruleId":"133","severity":1,"message":"134","line":80,"column":7,"nodeType":"135","messageId":"136","endLine":80,"endColumn":18},{"ruleId":"133","severity":1,"message":"134","line":87,"column":7,"nodeType":"135","messageId":"136","endLine":87,"endColumn":18},{"ruleId":"133","severity":1,"message":"134","line":109,"column":13,"nodeType":"135","messageId":"136","endLine":109,"endColumn":24},{"ruleId":"133","severity":1,"message":"134","line":139,"column":9,"nodeType":"135","messageId":"136","endLine":139,"endColumn":20},{"ruleId":"133","severity":1,"message":"134","line":158,"column":7,"nodeType":"135","messageId":"136","endLine":158,"endColumn":18},{"ruleId":"133","severity":1,"message":"134","line":162,"column":7,"nodeType":"135","messageId":"136","endLine":162,"endColumn":18},{"ruleId":"127","severity":1,"message":"145","line":180,"column":6,"nodeType":"129","endLine":180,"endColumn":13,"suggestions":"146"},{"ruleId":"137","severity":1,"message":"147","line":209,"column":10,"nodeType":"139","messageId":"140","endLine":209,"endColumn":24},{"ruleId":"141","severity":1,"message":"147","line":209,"column":10,"nodeType":"139","messageId":"140","endLine":209,"endColumn":24},"no-native-reassign",["148"],"no-negated-in-lhs",["149"],["148"],["149"],["148"],["149"],["148"],["149"],"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'history'. Either include it or remove the dependency array.","ArrayExpression",["150"],["148"],["149"],"no-console","Unexpected console statement.","MemberExpression","unexpected","no-unused-vars","'Link' is defined but never used.","Identifier","unusedVar","@typescript-eslint/no-unused-vars","'isCallActive' is defined but never used.",["148"],["149"],"React Hook useEffect has a missing dependency: 'activeChat._id'. Either include it or remove the dependency array.",["151"],"'addVideoStream' is defined but never used.","no-global-assign","no-unsafe-negation",{"desc":"152","fix":"153"},{"desc":"154","fix":"155"},"Update the dependencies array to be: [history]",{"range":"156","text":"157"},"Update the dependencies array to be: [activeChat._id, chats]",{"range":"158","text":"159"},[1007,1009],"[history]",[5054,5061],"[activeChat._id, chats]"]